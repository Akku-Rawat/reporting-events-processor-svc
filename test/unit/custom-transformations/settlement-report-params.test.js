const { getSettlementReportParams } = require('../../../src/custom-transformations/settlement-report-params')

describe('getSettlementReportParams', () => {
  beforeAll(() => {
    msgWithNoService = {
      id: '1a5daf40-5884-43dc-a676-e1f73e80dd03',
      content: { value: { from: 'payeefsp', to: 'testingtoolkitdfsp', id: '9fb8e20c-7faa-465e-9927-bcc57637fe71', content: { uriParams: { id: '9fb8e20c-7faa-465e-9927-bcc57637fe71' }, headers: { host: 'ml-api-adapter.bof1.test.mojaloop.live', 'x-request-id': '0a8b02dfb0184a661dbab8fd053e1108', 'x-real-ip': '10.1.2.87', 'x-forwarded-for': '10.1.2.87', 'x-forwarded-host': 'ml-api-adapter.bof1.test.mojaloop.live', 'x-forwarded-port': '80', 'x-forwarded-proto': 'http', 'x-scheme': 'http', 'content-length': '136', 'content-type': 'application/vnd.interoperability.transfers+json;version=1.0', date: '2021-09-01T14:34:16.000Z', 'fspiop-source': 'payeefsp', 'fspiop-destination': 'testingtoolkitdfsp', 'fspiop-http-method': 'PUT', 'fspiop-uri': '/transfers/9fb8e20c-7faa-465e-9927-bcc57637fe71', 'fspiop-signature': '{"signature":"iaz0SO9tCjJ5gUoDn8TQkm2oT6cZr_zrMqsSosF0J71W9_y8Tv99IUmFochTawxwmMyaVJ6fiR-yW51xLDthBC7hpqDm4kL2qlBHuK-xSiGFGhA1KmwsxxhHPg0YWGbmg5qHjP0RlxWqA4FdEm7nhRg1fz_EyPohOeraCB1Z6UJEI0M9q6cbSz80lm5Gjv6BSiobahYbheN6U3cXsWuk3gVCT3P78e3YxO_yWMxk8QrmCim8aS3ASLNvwb-GU68MQ_GWs26QXcDg4BYmydW6tIwqY816QZn4QNt0RQiORwqrslIbn7JGA8-aFWzCE4KmTDniFDWqtc7jVpZjO09UJQ","protectedHeader":"eyJhbGciOiJSUzI1NiIsIkZTUElPUC1VUkkiOiIvdHJhbnNmZXJzLzlmYjhlMjBjLTdmYWEtNDY1ZS05OTI3LWJjYzU3NjM3ZmU3MSIsIkZTUElPUC1IVFRQLU1ldGhvZCI6IlBVVCIsIkZTUElPUC1Tb3VyY2UiOiJwYXllZWZzcCIsIkZTUElPUC1EZXN0aW5hdGlvbiI6InRlc3Rpbmd0b29sa2l0ZGZzcCIsIkRhdGUiOiJXZWQsIDAxIFNlcCAyMDIxIDE0OjM0OjE2IEdNVCJ9"}' }, payload: 'data:application/vnd.interoperability.transfers+json;version=1.0;base64,eyJjb21wbGV0ZWRUaW1lc3RhbXAiOiIyMDIxLTA5LTAxVDE0OjM0OjE2Ljc1MVoiLCJ0cmFuc2ZlclN0YXRlIjoiQ09NTUlUVEVEIiwiZnVsZmlsbWVudCI6Imd6bGJzeHl0LUhERkNZUXZrT09xVUVvMVRQcDlmR0pGQWJGekFPZ1RFMHcifQ' }, type: 'application/json', metadata: { correlationId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', event: { type: 'notification', action: 'commit', createdAt: '2021-09-01T14:34:16.779Z', state: { status: 'success', code: 0, description: 'action successful' }, id: 'f05f6b90-0726-49f7-8c79-f959eb5a6cf5', responseTo: '9c8ce2cb-c2eb-4f1f-bd7c-e0c3a541c671' }, trace: { startTimestamp: '2021-09-01T14:34:16.875Z', traceId: '2eea686ac11f93e15a47ccff47ae69f3', spanId: 'fcdeefb7cf1a7cd1', parentSpanId: '0ef90aea045b5e1c', tags: { tracestate: 'mojaloop=eyJzcGFuSWQiOiJmY2RlZWZiN2NmMWE3Y2QxIiwidGltZUFwaUZ1bGZpbCI6IjE2MzA1MDY4NTY3NzUifQ==', transactionType: 'transfer', transactionAction: 'fulfil', transactionId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', source: 'payeefsp', destination: 'testingtoolkitdfsp' }, tracestates: { mojaloop: { spanId: 'fcdeefb7cf1a7cd1', timeApiFulfil: '1630506856775' } } }, 'protocol.createdAt': 1630506856927 } }, size: 2660, key: null, topic: 'topic-notification-event', offset: 14, partition: 0, timestamp: 1630506856927 },
      type: 'application/json',
      metadata: { event: { id: '1fc36623-be91-42d0-ab9a-bc6db275c81f', type: 'audit', action: 'start', createdAt: '2021-09-01T14:34:16.946Z', state: { status: 'success' } }, trace: { service: 'cs_process_transfer_settlement_window', traceId: '2eea686ac11f93e15a47ccff47ae69f3', spanId: 'de4c896a06fac5f1', parentSpanId: 'fcdeefb7cf1a7cd1', startTimestamp: '2021-09-01T14:34:16.945Z', tags: { tracestate: 'mojaloop=eyJzcGFuSWQiOiJkZTRjODk2YTA2ZmFjNWYxIiwidGltZUFwaUZ1bGZpbCI6IjE2MzA1MDY4NTY3NzUifQ==', transactionType: 'transfersettlement', transactionAction: 'processing', transactionId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', source: 'payeefsp', destination: 'testingtoolkitdfsp' } }, 'protocol.createdAt': 1630506856948 }
    }
    unprocessedSettlement = {
      id: '1a5daf40-5884-43dc-a676-e1f73e80dd03',
      content: { value: { from: 'payeefsp', to: 'testingtoolkitdfsp', id: '9fb8e20c-7faa-465e-9927-bcc57637fe71', content: { uriParams: { id: '9fb8e20c-7faa-465e-9927-bcc57637fe71' }, headers: { host: 'ml-api-adapter.bof1.test.mojaloop.live', 'x-request-id': '0a8b02dfb0184a661dbab8fd053e1108', 'x-real-ip': '10.1.2.87', 'x-forwarded-for': '10.1.2.87', 'x-forwarded-host': 'ml-api-adapter.bof1.test.mojaloop.live', 'x-forwarded-port': '80', 'x-forwarded-proto': 'http', 'x-scheme': 'http', 'content-length': '136', 'content-type': 'application/vnd.interoperability.transfers+json;version=1.0', date: '2021-09-01T14:34:16.000Z', 'fspiop-source': 'payeefsp', 'fspiop-destination': 'testingtoolkitdfsp', 'fspiop-http-method': 'PUT', 'fspiop-uri': '/transfers/9fb8e20c-7faa-465e-9927-bcc57637fe71', 'fspiop-signature': '{"signature":"iaz0SO9tCjJ5gUoDn8TQkm2oT6cZr_zrMqsSosF0J71W9_y8Tv99IUmFochTawxwmMyaVJ6fiR-yW51xLDthBC7hpqDm4kL2qlBHuK-xSiGFGhA1KmwsxxhHPg0YWGbmg5qHjP0RlxWqA4FdEm7nhRg1fz_EyPohOeraCB1Z6UJEI0M9q6cbSz80lm5Gjv6BSiobahYbheN6U3cXsWuk3gVCT3P78e3YxO_yWMxk8QrmCim8aS3ASLNvwb-GU68MQ_GWs26QXcDg4BYmydW6tIwqY816QZn4QNt0RQiORwqrslIbn7JGA8-aFWzCE4KmTDniFDWqtc7jVpZjO09UJQ","protectedHeader":"eyJhbGciOiJSUzI1NiIsIkZTUElPUC1VUkkiOiIvdHJhbnNmZXJzLzlmYjhlMjBjLTdmYWEtNDY1ZS05OTI3LWJjYzU3NjM3ZmU3MSIsIkZTUElPUC1IVFRQLU1ldGhvZCI6IlBVVCIsIkZTUElPUC1Tb3VyY2UiOiJwYXllZWZzcCIsIkZTUElPUC1EZXN0aW5hdGlvbiI6InRlc3Rpbmd0b29sa2l0ZGZzcCIsIkRhdGUiOiJXZWQsIDAxIFNlcCAyMDIxIDE0OjM0OjE2IEdNVCJ9"}' }, payload: 'data:application/vnd.interoperability.transfers+json;version=1.0;base64,eyJjb21wbGV0ZWRUaW1lc3RhbXAiOiIyMDIxLTA5LTAxVDE0OjM0OjE2Ljc1MVoiLCJ0cmFuc2ZlclN0YXRlIjoiQ09NTUlUVEVEIiwiZnVsZmlsbWVudCI6Imd6bGJzeHl0LUhERkNZUXZrT09xVUVvMVRQcDlmR0pGQWJGekFPZ1RFMHcifQ' }, type: 'application/json', metadata: { correlationId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', event: { type: 'notification', action: 'commit', createdAt: '2021-09-01T14:34:16.779Z', state: { status: 'success', code: 0, description: 'action successful' }, id: 'f05f6b90-0726-49f7-8c79-f959eb5a6cf5', responseTo: '9c8ce2cb-c2eb-4f1f-bd7c-e0c3a541c671' }, trace: { startTimestamp: '2021-09-01T14:34:16.875Z', service: 'cl_transfer_position', traceId: '2eea686ac11f93e15a47ccff47ae69f3', spanId: 'fcdeefb7cf1a7cd1', parentSpanId: '0ef90aea045b5e1c', tags: { tracestate: 'mojaloop=eyJzcGFuSWQiOiJmY2RlZWZiN2NmMWE3Y2QxIiwidGltZUFwaUZ1bGZpbCI6IjE2MzA1MDY4NTY3NzUifQ==', transactionType: 'transfer', transactionAction: 'fulfil', transactionId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', source: 'payeefsp', destination: 'testingtoolkitdfsp' }, tracestates: { mojaloop: { spanId: 'fcdeefb7cf1a7cd1', timeApiFulfil: '1630506856775' } } }, 'protocol.createdAt': 1630506856927 } }, size: 2660, key: null, topic: 'topic-notification-event', offset: 14, partition: 0, timestamp: 1630506856927 },
      type: 'application/json',
      metadata: { event: { id: '1fc36623-be91-42d0-ab9a-bc6db275c81f', type: 'audit', action: 'start', createdAt: '2021-09-01T14:34:16.946Z', state: { status: 'success' } }, trace: { service: 'cs_process_transfer_settlement_window', traceId: '2eea686ac11f93e15a47ccff47ae69f3', spanId: 'de4c896a06fac5f1', parentSpanId: 'fcdeefb7cf1a7cd1', startTimestamp: '2021-09-01T14:34:16.945Z', tags: { tracestate: 'mojaloop=eyJzcGFuSWQiOiJkZTRjODk2YTA2ZmFjNWYxIiwidGltZUFwaUZ1bGZpbCI6IjE2MzA1MDY4NTY3NzUifQ==', transactionType: 'transfersettlement', transactionAction: 'processing', transactionId: '9fb8e20c-7faa-465e-9927-bcc57637fe71', source: 'payeefsp', destination: 'testingtoolkitdfsp' } }, 'protocol.createdAt': 1630506856948 }
    }
  })

  it('Message with no service', () => {
    const result = getSettlementReportParams(msgWithNoService)
    expect(result).toEqual({})
  })

})
